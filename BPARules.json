[
  {
    "ID": "AVOID_DUPLICATE_MEASURES",
    "Name": "[DAX Expressions] No two measures should have the same definition",
    "Category": "DAX Expressions",
    "Description": "Two measures with different names and defined by the same DAX expression should be avoided to reduce redundancy.",
    "Severity": 2,
    "Scope": "Measure",
    "Expression": "Model.AllMeasures.Any(Expression.Replace(\" \",\"\").Replace(\"\\n\",\"\").Replace(\"\\r\",\"\").Replace(\"\\t\",\"\") = outerIt.Expression.Replace(\" \",\"\").Replace(\"\\n\",\"\").Replace(\"\\r\",\"\").Replace(\"\\t\",\"\") and it <> outerIt)",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "USE_THE_DIVIDE_FUNCTION_FOR_DIVISION",
    "Name": "[DAX Expressions] Use the DIVIDE function for division",
    "Category": "DAX Expressions",
    "Description": "Use the DIVIDE function instead of using \"/\". The DIVIDE function resolves divide-by-zero cases.",
    "Severity": 2,
    "Scope": "Measure, CalculatedColumn, CalculationItem",
    "Expression": "Expression.Contains(\"/\") and Expression.ToUpper().Contains(\"DIVIDE\") == false",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "INACTIVE_RELATIONSHIPS_THAT_ARE_NEVER_ACTIVATED",
    "Name": "[DAX Expressions] Inactive relationships that are never activated",
    "Category": "DAX Expressions",
    "Description": "Inactive relationships are only useful if they are activated in a measure using the USERELATIONSHIP function. Otherwise, they are redundant.",
    "Severity": 2,
    "Scope": "Relationship",
    "Expression": "IsActive == false\r\nand not (\r\n  Model.AllMeasures.Any(\r\n    Expression.ToUpper().Contains(\"USERELATIONSHIP\")\r\n    and (\r\n      Expression.Contains(\"'\" + current.FromTable.Name + \"'[\" + current.FromColumn.Name + \"]\")\r\n      or Expression.Contains(current.FromTable.Name + \"[\" + current.FromColumn.Name + \"]\")\r\n    )\r\n    and (\r\n      Expression.Contains(\"'\" + current.ToTable.Name + \"'[\" + current.ToColumn.Name + \"]\")\r\n      or Expression.Contains(current.ToTable.Name + \"[\" + current.ToColumn.Name + \"]\")\r\n    )\r\n  )\r\n  or\r\n  Model.AllCalculationItems.Any(\r\n    Expression.ToUpper().Contains(\"USERELATIONSHIP\")\r\n    and (\r\n      Expression.Contains(\"'\" + current.FromTable.Name + \"'[\" + current.FromColumn.Name + \"]\")\r\n      or Expression.Contains(current.FromTable.Name + \"[\" + current.FromColumn.Name + \"]\")\r\n    )\r\n    and (\r\n      Expression.Contains(\"'\" + current.ToTable.Name + \"'[\" + current.ToColumn.Name + \"]\")\r\n      or Expression.Contains(current.ToTable.Name + \"[\" + current.ToColumn.Name + \"]\")\r\n    )\r\n  )\r\n)",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "RELATIONSHIP_COLUMNS_SAME_DATA_TYPE",
    "Name": "[Error Prevention] Relationship columns should be of the same data type",
    "Category": "Error Prevention",
    "Description": "Columns used in a relationship should be of the same data type.",
    "Severity": 3,
    "Scope": "Relationship",
    "Expression": "FromColumn.DataType != ToColumn.DataType",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "SET_ISAVAILABLEINMDX_TO_TRUE_ON_NECESSARY_COLUMNS",
    "Name": "[Error Prevention] Set IsAvailableInMdx to true on necessary columns",
    "Category": "Error Prevention",
    "Description": "Enable attribute hierarchies if a column is used for sorting, hierarchies, variations, or as sort-by.",
    "Severity": 3,
    "Scope": "DataColumn, CalculatedColumn, CalculatedTableColumn",
    "Expression": "IsAvailableInMDX = false\r\nand\r\n(\r\nUsedInSortBy.Any()\r\nor\r\nUsedInHierarchies.Any()\r\nor\r\nUsedInVariations.Any()\r\nor\r\nSortByColumn != null\r\n)",
    "FixExpression": "IsAvailableInMDX = true",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "NUMERIC_COLUMN_SUMMARIZE_BY",
    "Name": "[Formatting] Do not summarize numeric columns",
    "Category": "Formatting",
    "Description": "Numeric columns (integer, decimal, double) should have SummarizeBy = None to avoid accidental summation in Power BI (create measures instead).",
    "Severity": 3,
    "Scope": "DataColumn, CalculatedColumn, CalculatedTableColumn",
    "Expression": "(\r\nDataType = \"Int64\"\r\nor\r\nDataType = \"Decimal\"\r\nor\r\nDataType = \"Double\"\r\n)\r\nand\r\nSummarizeBy <> \"None\"\r\nand not (IsHidden or Table.IsHidden)",
    "FixExpression": "SummarizeBy = AggregateFunction.None",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "RELATIONSHIP_COLUMNS_SHOULD_BE_OF_INTEGER_DATA_TYPE",
    "Name": "[Formatting] Relationship columns should be of integer data type",
    "Category": "Formatting",
    "Description": "It is a best practice for relationship columns to be of integer data type.",
    "Severity": 1,
    "Scope": "Relationship",
    "Expression": "FromColumn.DataType != DataType.Int64 or ToColumn.DataType != DataType.Int64",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "HIDE_FOREIGN_KEYS",
    "Name": "[Formatting] Hide foreign keys",
    "Category": "Formatting",
    "Description": "Foreign keys should generally be hidden.",
    "Severity": 2,
    "Scope": "DataColumn, CalculatedColumn, CalculatedTableColumn",
    "Expression": "UsedInRelationships.Any(FromColumn.Name == current.Name and FromCardinality == \"Many\")\r\nand\r\nIsHidden == false",
    "FixExpression": "IsHidden = true",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "HIDE_FACT_TABLE_COLUMNS",
    "Name": "[Formatting] Hide fact table columns",
    "Category": "Formatting",
    "Description": "Columns in fact tables should generally be hidden (Fact_*).",
    "Severity": 2,
    "Scope": "DataColumn, CalculatedColumn, CalculatedTableColumn",
    "Expression": "IsHidden == false\r\nand IsKey == false\r\nand IsCalculated == false\r\nand IsNameInferred == false\r\nand (not UsedInRelationships.Any())\r\nand (not UsedInSortBy.Any())\r\nand (not UsedInHierarchies.Any())\r\nand Table.Name.StartsWith(\"Fact_\")",
    "FixExpression": "IsHidden = true",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "UNNECESSARY_COLUMNS",
    "Name": "[Maintenance] Remove unnecessary columns",
    "Category": "Maintenance",
    "Description": "Hidden columns that are not referenced by any expressions, relationships, hierarchy levels or Sort By-properties should be removed.",
    "Severity": 2,
    "Scope": "DataColumn, CalculatedColumn, CalculatedTableColumn",
    "Expression": "(IsHidden or Table.IsHidden)\r\nand ReferencedBy.Count = 0\r\nand (not UsedInRelationships.Any())\r\nand (not UsedInSortBy.Any())\r\nand (not UsedInHierarchies.Any())",
    "FixExpression": "Delete()",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "FIX_REFERENTIAL_INTEGRITY_VIOLATIONS",
    "Name": "[Maintenance] Fix referential integrity violations",
    "Category": "Maintenance",
    "Description": "Highlights relationships which have referential integrity violations (requires VertiPaq annotations).",
    "Severity": 2,
    "Scope": "Relationship",
    "Expression": "!string.IsNullOrWhitespace(GetAnnotation(\"Vertipaq_RIViolationInvalidRows\"))\r\nand\r\nConvert.ToInt64(GetAnnotation(\"Vertipaq_RIViolationInvalidRows\")) > 0",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "ENSURE_TABLES_HAVE_RELATIONSHIPS",
    "Name": "[Maintenance] Ensure tables have relationships",
    "Category": "Maintenance",
    "Description": "Highlights tables which are not connected to any other table in the model with a relationship.",
    "Severity": 1,
    "Scope": "Table, CalculatedTable",
    "Expression": "UsedInRelationships.Count() == 0",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "AVOID_FLOATING_POINT_DATA_TYPES",
    "Name": "[Performance] Do not use floating point data types",
    "Category": "Performance",
    "Description": "The \"Double\" floating point data type should be avoided where possible due to rounding issues and potential performance impact.",
    "Severity": 2,
    "Scope": "DataColumn, CalculatedColumn, CalculatedTableColumn",
    "Expression": "DataType = \"Double\"",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "AVOID_BI-DIRECTIONAL_RELATIONSHIPS_AGAINST_HIGH-CARDINALITY_COLUMNS",
    "Name": "[Performance] Avoid bi-directional relationships against high-cardinality columns",
    "Category": "Performance",
    "Description": "Avoid bi-directional relationships against high-cardinality columns (requires VertiPaq cardinality annotations on columns).",
    "Severity": 2,
    "Scope": "Relationship",
    "Expression": "(CrossFilteringBehavior == CrossFilteringBehavior.BothDirections or CrossFilteringBehavior == CrossFilteringBehavior.Automatic)\r\nand\r\n(\r\n  (!string.IsNullOrWhitespace(FromColumn.GetAnnotation(\"Vertipaq_Cardinality\"))\r\n   and Convert.ToInt64(FromColumn.GetAnnotation(\"Vertipaq_Cardinality\")) > 100000)\r\n  or\r\n  (!string.IsNullOrWhitespace(ToColumn.GetAnnotation(\"Vertipaq_Cardinality\"))\r\n   and Convert.ToInt64(ToColumn.GetAnnotation(\"Vertipaq_Cardinality\")) > 100000)\r\n)",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "REDUCE_USAGE_OF_LONG-LENGTH_COLUMNS_WITH_HIGH_CARDINALITY",
    "Name": "[Performance] Reduce usage of long-length columns with high cardinality",
    "Category": "Performance",
    "Description": "Avoid lengthy text columns with many unique values (uses VertiPaq annotations when available).",
    "Severity": 2,
    "Scope": "DataColumn, CalculatedColumn, CalculatedTableColumn",
    "Expression": "!string.IsNullOrWhitespace(GetAnnotation(\"LongLengthRowCount\"))\r\nand\r\nConvert.ToInt64(GetAnnotation(\"LongLengthRowCount\")) > 500000",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "SNOWFLAKE_SCHEMA_ARCHITECTURE",
    "Name": "[Performance] Consider a star-schema instead of a snowflake architecture",
    "Category": "Performance",
    "Description": "Generally speaking, a star-schema is the optimal architecture for tabular models. This flags tables that appear to be both a parent and a child in relationships (often seen in snowflaking).",
    "Severity": 2,
    "Scope": "Table, CalculatedTable",
    "Expression": "UsedInRelationships.Any(current.Name == FromTable.Name)\r\nand\r\nUsedInRelationships.Any(current.Name == ToTable.Name)",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "REMOVE_AUTO-DATE_TABLE",
    "Name": "[Performance] Remove auto-date table",
    "Category": "Performance",
    "Description": "Avoid using auto-date tables. Disable Auto date/time in Power BI Desktop to reduce model size and improve performance.",
    "Severity": 2,
    "Scope": "Table, CalculatedTable",
    "Expression": "ObjectTypeName == \"Calculated Table\"\r\nand\r\n(\r\nName.StartsWith(\"DateTableTemplate_\")\r\nor\r\nName.StartsWith(\"LocalDateTable_\")\r\n)",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "MANY-TO-MANY_RELATIONSHIPS_SHOULD_BE_SINGLE-DIRECTION",
    "Name": "[Performance] Many-to-many relationships should be single-direction",
    "Category": "Performance",
    "Description": "Many-to-many relationships should generally be single-direction to avoid ambiguous filter propagation and improve performance.",
    "Severity": 2,
    "Scope": "Relationship",
    "Expression": "FromCardinality == \"Many\"\r\nand\r\nToCardinality == \"Many\"\r\nand\r\n(CrossFilteringBehavior == \"BothDirections\" or CrossFilteringBehavior == \"Automatic\")",
    "FixExpression": "CrossFilteringBehavior = \"OneDirection\"",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "REDUCE_USAGE_OF_CALCULATED_TABLES",
    "Name": "[Performance] Reduce usage of calculated tables",
    "Category": "Performance",
    "Description": "Calculated tables increase model size and may slow down refresh. Consider using Power Query instead.",
    "Severity": 2,
    "Scope": "CalculatedTable",
    "Expression": "1=1",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "REMOVE_REDUNDANT_COLUMNS_IN_RELATED_TABLES",
    "Name": "[Performance] Remove redundant columns in related tables",
    "Category": "Performance",
    "Description": "Tables with relationships that still contain visible unused columns (not referenced, not in relationships, not used for sorting/hierarchies).",
    "Severity": 2,
    "Scope": "Table, CalculatedTable",
    "Expression": "UsedInRelationships.Count() > 0\r\nand\r\nColumns.Any(\r\n  (not IsHidden)\r\n  and IsKey == false\r\n  and ReferencedBy.Count = 0\r\n  and (not UsedInRelationships.Any())\r\n  and (not UsedInSortBy.Any())\r\n  and (not UsedInHierarchies.Any())\r\n)",
    "CompatibilityLevel": 1200
  },
  {
    "ID": "REDUCE_NUMBER_OF_CALCULATED_COLUMNS",
    "Name": "[Performance] Reduce number of calculated columns",
    "Category": "Performance",
    "Description": "Calculated columns increase model size and may slow down refresh. Consider using Power Query or measures instead.",
    "Severity": 2,
    "Scope": "Model",
    "Expression": "AllColumns.Where(Type.ToString() == \"Calculated\").Count() > 5",
    "CompatibilityLevel": 1200
  }
]
